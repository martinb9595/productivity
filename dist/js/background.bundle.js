(()=>{var e={762:e=>{e.exports={startFocusMode:function(e){},endFocusMode:function(){}}}},t={};function o(s){var a=t[s];if(void 0!==a)return a.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,o),n.exports}(()=>{"use strict";var e=o(762);function t(e,t){if(t)if(e>0){var o=Math.floor(e/60),s=e%60;t.textContent="Time remaining in focus mode: ".concat(o,":").concat(s.toString().padStart(2,"0"))}else t.textContent="Focus mode ended"}var s={focusSessions:0,totalFocusTime:0,dailyFocusTime:{},websitesBlocked:{},streaks:{currentStreak:0,longestStreak:0,lastFocusDate:null}};self.addEventListener("install",(function(e){console.log("Service worker installed")})),self.addEventListener("activate",(function(e){console.log("Service worker activated")}));var a,n=[],r=!1,c=0,i={focusSessions:0,totalFocusTime:0,dailyFocusTime:{},websitesBlocked:{},streaks:{currentStreak:0,longestStreak:0,lastFocusDate:null}};chrome.runtime.onInstalled.addListener((function(){chrome.storage.sync.get(["blockedSites"],(function(e){e.blockedSites&&(n=e.blockedSites)})),chrome.storage.local.get(["isInFocusMode"],(function(e){e.isInFocusMode&&(r=e.isInFocusMode)}))})),chrome.storage.onChanged.addListener((function(e,t){"sync"===t&&e.blockedSites&&(n=e.blockedSites.newValue),"local"===t&&e.isInFocusMode&&(r=e.isInFocusMode.newValue)})),chrome.runtime.onMessage.addListener((function(o,n,u){if("startFocusMode"===o.action){var l=60*o.duration*1e3;return isNaN(l)||l<=0?(console.error("Invalid focus duration"),void u({success:!1,message:"Invalid focus duration"})):(chrome.storage.local.set({isInFocusMode:!0},(function(){c=Date.now()+l,chrome.alarms.create("focusModeEnd",{when:c}),function(o){var n=o;t(n),i.focusSessions++;var r=(new Date).toISOString().split("T")[0];i.dailyFocusTime[r]=(i.dailyFocusTime[r]||0)+o/60,i.totalFocusTime+=o/60,function(e){if(s.streaks.lastFocusDate!==e){var t=new Date(new Date(e).setDate(new Date(e).getDate()-1)).toISOString().split("T")[0];s.streaks.lastFocusDate===t?s.streaks.currentStreak++:s.streaks.currentStreak=1,s.streaks.currentStreak>s.streaks.longestStreak&&(s.streaks.longestStreak=s.streaks.currentStreak),s.streaks.lastFocusDate=e}}(r),chrome.storage.local.set({productivityAnalytics:i}),a=setInterval((function(){t(--n),n<=0&&(clearInterval(a),(0,e.endFocusMode)())}),1e3)}(60*o.duration),u({success:!0})})),!0)}if("endFocusMode"===o.action)return chrome.storage.local.set({isInFocusMode:!1},(function(){chrome.alarms.clear("focusModeEnd"),clearInterval(a),u({success:!0})})),!0;if("updatePopup"===o.action)chrome.storage.local.get(["isInFocusMode","focusEndTime"],(function(e){if(e.isInFocusMode&&e.focusEndTime){var t=Math.max(0,Math.floor((e.focusEndTime-Date.now())/1e3));chrome.runtime.sendMessage({action:"updateTimer",timeRemaining:t})}})),u({success:!0});else if("getTimerStatus"===o.action){var d=r?Math.max(0,Math.floor((c-Date.now())/1e3)):0;u({timeRemaining:d})}else u({success:!1,message:"Unknown action"})})),chrome.webNavigation.onBeforeNavigate.addListener((function(e){if(r&&Date.now()<c&&0===e.frameId){var t=new URL(e.url);n.some((function(e){return t.hostname.includes(e)}))&&(chrome.tabs.update(e.tabId,{url:chrome.runtime.getURL("src/html/blocked.html")}),chrome.storage.local.get({blockedPages:[]},(function(e){var o=e.blockedPages;o.push(t.href),chrome.storage.local.set({blockedPages:o})})))}}))})()})();