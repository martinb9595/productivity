(()=>{var e={762:()=>{}},o={};function t(s){var n=o[s];if(void 0!==n)return n.exports;var c=o[s]={exports:{}};return e[s](c,c.exports,t),c.exports}(()=>{"use strict";var e=t(762);function o(e,o){if(o)if(e>0){var t=Math.floor(e/60),s=e%60;o.textContent="Time remaining in focus mode: ".concat(t,":").concat(s.toString().padStart(2,"0"))}else o.textContent="Focus mode ended"}self.addEventListener("install",(function(e){console.log("Service worker installed")})),self.addEventListener("activate",(function(e){console.log("Service worker activated")}));var s,n=[],c=!1,a=0,i={focusSessions:0,totalFocusTime:0,dailyFocusTime:{},websitesBlocked:{},streaks:{currentStreak:0,longestStreak:0,lastFocusDate:null}};chrome.runtime.onInstalled.addListener((function(){chrome.storage.sync.get(["blockedSites"],(function(e){e.blockedSites&&(n=e.blockedSites)})),chrome.storage.local.get(["isInFocusMode","focusEndTime"],(function(e){e.isInFocusMode&&(c=e.isInFocusMode,a=e.focusEndTime||0)}))})),chrome.storage.onChanged.addListener((function(e,o){"sync"===o&&e.blockedSites&&(n=e.blockedSites.newValue),"local"===o&&e.isInFocusMode&&(c=e.isInFocusMode.newValue)})),chrome.runtime.onMessage.addListener((function(t,n,r){if("startFocusMode"===t.action){var u=60*t.duration*1e3;return isNaN(u)||u<=0?(console.error("Invalid focus duration"),void r({success:!1,message:"Invalid focus duration"})):(a=Date.now()+u,chrome.storage.local.set({isInFocusMode:!0,focusEndTime:a},(function(){chrome.alarms.create("focusModeEnd",{when:a}),function(t){var n=t;o(n),i.focusSessions++;var c=(new Date).toISOString().split("T")[0];i.dailyFocusTime[c]=(i.dailyFocusTime[c]||0)+t/60,i.totalFocusTime+=t/60,updateStreak(c),chrome.storage.local.set({productivityAnalytics:i}),s=setInterval((function(){o(--n),n<=0&&(clearInterval(s),(0,e.endFocusMode)())}),1e3)}(60*t.duration),r({success:!0})})),!0)}if("endFocusMode"===t.action)return chrome.storage.local.set({isInFocusMode:!1},(function(){chrome.alarms.clear("focusModeEnd"),clearInterval(s),r({success:!0})})),!0;if("updatePopup"===t.action)chrome.storage.local.get(["isInFocusMode","focusEndTime"],(function(e){if(e.isInFocusMode&&e.focusEndTime){var o=Math.max(0,Math.floor((e.focusEndTime-Date.now())/1e3));chrome.runtime.sendMessage({action:"updateTimer",timeRemaining:o})}})),r({success:!0});else if("getTimerStatus"===t.action){var d=c?Math.max(0,Math.floor((a-Date.now())/1e3)):0;r({timeRemaining:d})}else r({success:!1,message:"Unknown action"})})),chrome.webNavigation.onBeforeNavigate.addListener((function(e){if(c&&Date.now()<a&&0===e.frameId){var o=new URL(e.url);n.some((function(e){return o.hostname.includes(e)}))&&(chrome.tabs.update(e.tabId,{url:chrome.runtime.getURL("src/html/blocked.html")}),chrome.storage.local.get({blockedPages:[]},(function(e){var t=e.blockedPages;t.push(o.href),chrome.storage.local.set({blockedPages:t})})))}}))})()})();