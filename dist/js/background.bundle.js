(()=>{var e={762:()=>{}},o={};function t(n){var s=o[n];if(void 0!==s)return s.exports;var a=o[n]={exports:{}};return e[n](a,a.exports,t),a.exports}(()=>{"use strict";var e=t(762);function o(e,o){o&&(o.textContent=e>0?"Time remaining in focus mode: ".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")):"Focus mode ended")}self.addEventListener("install",(function(){return console.log("Service worker installed")})),self.addEventListener("activate",(function(){return console.log("Service worker activated")}));var n,s=[],a=!1,c=0,r={focusSessions:0,totalFocusTime:0,dailyFocusTime:{},websitesBlocked:{},streaks:{currentStreak:0,longestStreak:0,lastFocusDate:null}};chrome.runtime.onInstalled.addListener((function(){chrome.storage.sync.get(["blockedSites"],(function(e){s=e.blockedSites||[]})),chrome.storage.local.get(["isInFocusMode","focusEndTime"],(function(e){a=e.isInFocusMode||!1,c=e.focusEndTime||0}))})),chrome.storage.onChanged.addListener((function(e,o){"sync"===o&&e.blockedSites&&(s=e.blockedSites.newValue),"local"===o&&e.isInFocusMode&&(a=e.isInFocusMode.newValue)})),chrome.runtime.onMessage.addListener((function(t,s,i){if("startFocusMode"===t.action){var u=60*t.duration*1e3;return isNaN(u)||u<=0?void i({success:!1,message:"Invalid focus duration"}):(c=Date.now()+u,chrome.storage.local.set({isInFocusMode:!0,focusEndTime:c},(function(){chrome.alarms.create("focusModeEnd",{when:c}),function(t){var s=t;o(s),r.focusSessions++;var a=(new Date).toISOString().split("T")[0];r.dailyFocusTime[a]=(r.dailyFocusTime[a]||0)+t/60,r.totalFocusTime+=t/60,updateStreak(a),chrome.storage.local.set({productivityAnalytics:r}),n=setInterval((function(){o(--s),s<=0&&(clearInterval(n),(0,e.endFocusMode)())}),1e3)}(60*t.duration),i({success:!0})})),!0)}if("endFocusMode"===t.action)return chrome.storage.local.set({isInFocusMode:!1},(function(){chrome.alarms.clear("focusModeEnd"),clearInterval(n),i({success:!0})})),!0;if("updatePopup"===t.action)chrome.storage.local.get(["isInFocusMode","focusEndTime"],(function(e){if(e.isInFocusMode&&e.focusEndTime){var o=Math.max(0,Math.floor((e.focusEndTime-Date.now())/1e3));chrome.runtime.sendMessage({action:"updateTimer",timeRemaining:o})}})),i({success:!0});else if("getTimerStatus"===t.action){var d=a?Math.max(0,Math.floor((c-Date.now())/1e3)):0;i({timeRemaining:d})}else i({success:!1,message:"Unknown action"})})),chrome.webNavigation.onBeforeNavigate.addListener((function(e){if(a&&Date.now()<c&&0===e.frameId){var o=new URL(e.url);s.some((function(e){return o.hostname.includes(e)}))&&(chrome.tabs.update(e.tabId,{url:chrome.runtime.getURL("src/html/blocked.html")}),chrome.storage.local.get({blockedPages:[]},(function(e){var t=e.blockedPages;t.push(o.href),chrome.storage.local.set({blockedPages:t})})))}}))})()})();